<nav>
  <a class="logo" href="index.html">
    <span class="logo-mark">FeedbackLens</span>
  </a>
  <div class="nav-right">
    <div class="nav-tabs">
      <a class="nav-tab" href="index.html">Feedback einreichen</a>
      <a class="nav-tab active" href="admin-dashboard.html">Admin</a>
    </div>
    <button class="logout-btn" onclick="logout()">Abmelden</button>
  </div>
</nav>

<div class="dashboard">
  <div class="dash-header">
    <div>
      <div class="dash-title">Feedback-Dashboard</div>
      <div class="dash-meta" id="lastUpdated">
        Letzte 7 Tage ¬∑ Stand:
        {{ now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }) }} uhr
      </div>
    </div>
    <button class="btn-refresh" id="refreshBtn" onclick="refreshDashboard()">
      <span class="refresh-icon">‚Üª</span> Aktualisieren
    </button>
  </div>

  <!-- STAT CARDS -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-accent total"></div>
      <div class="stat-label">Gesamt (7 Tage)</div>
      <div class="stat-value" id="statTotal">{{ totalCount() }}</div>
      <div class="stat-sub">Einreichungen</div>
    </div>
    <div class="stat-card">
      <div class="stat-accent positive"></div>
      <div class="stat-label">Positiv</div>
      <div class="stat-value" id="statPositive" style="color: var(--positive)">
        {{ positiveCount() }}
      </div>
      <div class="stat-sub" id="statPositivePct">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="stat-accent negative"></div>
      <div class="stat-label">Negativ</div>
      <div class="stat-value" id="statNegative" style="color: var(--negative)">
        {{ negativeCount() }}
      </div>
      <div class="stat-sub" id="statNegativePct">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="stat-accent neutral"></div>
      <div class="stat-label">Neutral / Gemischt</div>
      <div class="stat-value" id="statNeutral" style="color: var(--warm-gray)">
        {{ neutralCount() }}
      </div>
      <div class="stat-sub" id="statNeutralPct">‚Äî</div>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-section">
    <div class="section-header">
      <div class="section-title">Sentiment-Verteilung</div>
      <span class="section-badge">letzte 7 Tage</span>
    </div>
    <div class="chart-legend">
      <div class="legend-item">
        <div class="legend-dot pos"></div>
        Positiv
      </div>
      <div class="legend-item">
        <div class="legend-dot neg"></div>
        Negativ
      </div>
      <div class="legend-item">
        <div class="legend-dot neu"></div>
        Neutral/Gemischt
      </div>
    </div>
    <div class="chart-bars" id="chartBars">
      @for (day of chartData(); track day.dateKey) {
        <div class="chart-bar-wrap">
          <div class="chart-stack">
            @if (day.positive > 0) {
              <div
                class="chart-bar pos"
                [style.height.px]="(day.positive / maxDayTotal()) * 100"
                [title]="day.positive + ' positiv'"
              ></div>
            }

            @if (day.negative > 0) {
              <div
                class="chart-bar neg"
                [style.height.px]="(day.negative / maxDayTotal()) * 100"
                [title]="day.negative + ' negativ'"
              ></div>
            }

            @if (day.neutral > 0) {
              <div
                class="chart-bar neu"
                [style.height.px]="(day.neutral / maxDayTotal()) * 100"
                [title]="day.neutral + ' neutral/gemischt'"
              ></div>
            }
          </div>

          <div class="chart-bar-label">
            {{ day.label }}
          </div>
        </div>
      }
    </div>

    <!-- ENTRIES -->
    <div class="entries-section">
      <div class="entries-header">
        <div class="section-header" style="margin-bottom: 0">
          <div class="section-title">Alle Eintr√§ge</div>
        </div>
        <div class="filter-bar">
          <span class="filter-label">Filter:</span>
          <button class="filter-btn active" onclick="setFilter('ALL', this)">Alle</button>
          <button class="filter-btn POSITIVE" onclick="setFilter('POSITIVE', this)">Positiv</button>
          <button class="filter-btn NEGATIVE" onclick="setFilter('NEGATIVE', this)">Negativ</button>
          <button class="filter-btn NEUTRAL" onclick="setFilter('NEUTRAL', this)">Neutral</button>
          <button class="filter-btn MIXED" onclick="setFilter('MIXED', this)">Gemischt</button>
        </div>
      </div>
      <div class="entry-list" id="entryList">
        @for (feedback of feedbacks(); track $index) {
          <div class="entry-item">
            <div class="entry-top">
              <div class="entry-text">{{ feedback.text }}</div>
              <div class="entry-meta">
                <span class="sentiment-pill {{ feedback.sentiment }}">{{
                  feedback.sentiment === 'POSITIVE'
                    ? 'üòä Positiv'
                    : feedback.sentiment === 'NEGATIVE'
                      ? 'üòû Negativ'
                      : 'üòê Neutral'
                }}</span>
                <div class="entry-date">{{ feedback.createdAt }}</div>
              </div>
            </div>
            <div class="entry-bottom">
              <div class="confidence-bar-wrap">
                <span class="confidence-label">Konfidenz</span>
                <div class="confidence-bar-bg">
                  <div class="confidence-bar-fill" style="width: 97%"></div>
                </div>
                <span class="confidence-val"
                  >{{
                    feedback.sentiment === 'POSITIVE'
                      ? feedback.confidenceJson[feedback.sentiment]
                      : feedback.sentiment === 'NEGATIVE'
                        ? feedback.confidenceJson[feedback.sentiment]
                        : feedback.confidenceJson[feedback.sentiment]
                  }}%</span
                >
              </div>
              <div class="keywords-wrap">
                @for (keyword of feedback.keyPhrasesJson; track $index) {
                  <span class="keyword-chip">{{ keyword }}</span>
                }
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>
